#!/usr/bin/env node

var args = require('minimist')(process.argv.slice(2));
var contributors = require('../lib/contributors');
var table = require('../lib/strategies/table');
var list = require('../lib/strategies/list');
var fs = require('fs');
var strategies = {
  table: table,
  list: list
};

if (args.layout) {
  if (fs.fileExistsSync(args.layout)) {
    strategies.custom = require(args.layout);
    args.layout = 'custom';
  } else {
    throw new Error('Invalid layout strategy', args.layout);
    process.exit(0);
  }
} else {
  args.layout = 'table';
}

if (args.sortStrategy) {
  if (fs.fileExistsSync(args.sortStrategy)) {
    args.sortStrategy = require(args.sortStrategy);
  } else {
    throw new Error('Invalid sort strategy', args.layout);
    process.exit(0);
  }
}

if (args.filter) {
  args.filter = args.filter.split(',').filter(function (u) {
    return u.length > 0;
  }).map(function (u) {
    return u.trim();
  });
} else {
  args.filter = [];
}

args.strategy = strategies[args.layout](args);
contributors = contributors(args);

contributors.get()
.then(function (obj) {
  console.log(obj);
});
